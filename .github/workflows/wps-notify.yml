name: WPS Notification

on:
  push:
    branches: [main, master]
  pull_request:
    types: [closed]

jobs:
  notify:
    runs-on: ubuntu-latest
    if: github.event_name == 'push' || github.event.pull_request.merged == true
    
    steps:
      - name: Send WPS Notification
        run: |
          if [ "${{ github.event_name }}" == "push" ]; then
            EVENT_TYPE="Push"
            BRANCH="${{ github.ref_name }}"
            AUTHOR="${{ github.actor }}"
            MESSAGE="${{ github.event.head_commit.message }}"
            COMMIT_URL="${{ github.event.head_commit.url }}"
            
            CONTENT="## ğŸ“¦ ä»£ç æ¨é€é€šçŸ¥\n\n**åˆ†æ”¯**: ${BRANCH}\n**æäº¤è€…**: ${AUTHOR}\n**æäº¤ä¿¡æ¯**: ${MESSAGE}\n\n[æŸ¥çœ‹æäº¤](${COMMIT_URL})"
          else
            EVENT_TYPE="Merge"
            PR_TITLE="${{ github.event.pull_request.title }}"
            PR_AUTHOR="${{ github.event.pull_request.user.login }}"
            PR_URL="${{ github.event.pull_request.html_url }}"
            
            CONTENT="## ğŸ”€ PRåˆå¹¶é€šçŸ¥\n\n**æ ‡é¢˜**: ${PR_TITLE}\n**ä½œè€…**: ${PR_AUTHOR}\n\n[æŸ¥çœ‹PR](${PR_URL})"
          fi
          
          curl -X POST "${{ secrets.WPS_WEBHOOK}}" \
            -H "Content-Type: application/json" \
            -d "{\"msgtype\":\"markdown\",\"markdown\":{\"text\":\"${CONTENT}\"}}"